config:
  branches:
    main:
      openShiftVersions:
      - cron: 0 4 * * *
        generateCustomConfigs: true
        version: "4.14"
      - cron: 0 6 * * *
        onDemand: true
        version: "4.11"
repositories:
- customConfigs:
  - name: aws-ovn
    releaseBuildConfiguration:
      tests:
      - as: e2e-aws-ovn-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: aws
          test:
          - as: operator-e2e
            commands: make test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-serving-eventing-e2e
            commands: make test-upstream-e2e-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-eventing-kafka-broker-e2e
            commands: make test-upstream-e2e-kafka-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: openshift-e2e-aws-ovn
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: azure
    releaseBuildConfiguration:
      tests:
      - as: e2e-azure-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: azure4
          test:
          - as: operator-e2e
            commands: make test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-serving-eventing-e2e
            commands: make test-upstream-e2e-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-eventing-kafka-broker-e2e
            commands: make test-upstream-e2e-kafka-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: openshift-e2e-azure
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: gcp
    releaseBuildConfiguration:
      tests:
      - as: e2e-gcp-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: gcp
          test:
          - as: operator-e2e
            commands: make test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-serving-eventing-e2e
            commands: make test-upstream-e2e-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-eventing-kafka-broker-e2e
            commands: make test-upstream-e2e-kafka-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: openshift-e2e-gcp
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: hypershift
    releaseBuildConfiguration:
      base_images:
        hypershift-operator:
          name: "4.14"
          namespace: ocp
          tag: hypershift-operator
        upi-installer:
          name: "4.14"
          namespace: ocp
          tag: upi-installer
      releases:
        latest:
          integration:
            include_built_images: true
            name: "4.14"
            namespace: ocp
      tests:
      - as: e2e-hypershift-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: aws-cspi-qe
          env:
            BASE_DOMAIN: cspilp.interop.ccitredhat.com
            COMPUTE_NODE_REPLICAS: "5"
            HYPERSHIFT_BASE_DOMAIN: cspilp.interop.ccitredhat.com
          test:
          - as: operator-e2e
            commands: make USER_MANAGEMENT_ALLOWED=false test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-serving-eventing-e2e
            commands: make test-upstream-e2e-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-eventing-kafka-broker-e2e
            commands: make test-upstream-e2e-kafka-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: cucushift-installer-rehearse-aws-ipi-ovn-hypershift-guest
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: osd
    releaseBuildConfiguration:
      base_images:
        cli-ocm:
          name: cli-ocm
          namespace: ci
          tag: latest
      tests:
      - as: e2e-osd-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: osd-ephemeral
          env:
            CLUSTER_DURATION: "10800"
            CLUSTER_VERSION: "4.14"
            COMPUTE_NODES: "4"
          post:
          - chain: gather
          - ref: osd-delete-delete
          pre:
          - ref: ipi-install-rbac
          - ref: osd-create-create
          test:
          - as: operator-e2e
            commands: make test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          - as: knative-serving-eventing-e2e
            commands: make test-upstream-e2e-no-upgrade
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: single-node
    releaseBuildConfiguration:
      tests:
      - as: e2e-sno-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: gcp
          test:
          - as: operator-e2e
            commands: make HA=false test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: openshift-e2e-gcp-single-node
        timeout: 8h0m0s
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  - name: vsphere
    releaseBuildConfiguration:
      base_images:
        upi-installer:
          name: "4.14"
          namespace: ocp
          tag: upi-installer
      tests:
      - as: e2e-vsphere-continuous
        cron: 0 0 * * 0
        steps:
          cluster_profile: vsphere-2
          test:
          - as: operator-e2e
            commands: make HA=false test-e2e-with-kafka
            from: serverless-source-image
            resources:
              limits:
                memory: 6Gi
              requests:
                cpu: 100m
                memory: 200Mi
          workflow: openshift-e2e-vsphere-upi
      zz_generated_metadata:
        branch: ""
        org: ""
        repo: ""
  dockerfiles:
    matches:
    - knative-operator/.*
    - openshift-knative-operator/.*
    - serving/metadata-webhook/.*
    - serving/ingress/.*
    - olm-catalog/serverless-operator/Dockerfile
    - olm-catalog/serverless-operator/index/Dockerfile
  e2e:
  - match: ^operator-e2e$
  - match: ^test-upgrade$
  - ignoreError: true
    match: ^upstream-e2e$
    skipCron: true
  - ignoreError: true
    match: ^upstream-e2e-kafka$
  - ignoreError: true
    match: ^mesh-e2e$
    onDemand: true
    timeout: 4h0m0s
  - ignoreError: true
    match: ^mesh-upgrade$
    onDemand: true
    skipCron: true
  - ignoreError: true
    match: ^ui-e2e$
    onDemand: true
    runIfChanged: test/ui
  - ignoreError: true
    match: ^kitchensink-e2e$
    onDemand: true
  - ignoreError: true
    match: ^kitchensink-upgrade$
    onDemand: true
  ignoreConfigs:
    matches:
    - .*main.yaml$
    - .*lp-interop.*
    - .*lp-interop.*
  imageNameOverrides:
    serverless-operator: bundle
  imagePrefix: serverless
  org: openshift-knative
  promotion:
    namespace: knative
  repo: serverless-operator
  resources:
    '*':
      limits:
        memory: 6Gi
      requests:
        cpu: 100m
        memory: 200Mi
  slackChannel: '#serverless-ci'
